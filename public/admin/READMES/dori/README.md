# 도리짓고땡 게임 관리

## 1. 용어 정의
### 1.1 게임 기본 용어
- 스팟(Spot): 베팅 가능한 위치 (1번, 2번, 3번)
- 선(뱅커/Banker): 다른 플레이어들과 승부를 겨루는 기준이 되는 스팟
- 끗: 두 카드의 합의 일의 자리 숫자 (예: 4+5=9끗, 8+2=0끗[망통])
- 땡: 같은 숫자 두 장 (예: 4+4=4땡, 10+10=장땡)
- 짓기: 세 장의 카드 합이 10, 20, 30이 되는 조합
- 황: 어떤 세 장의 조합으로도 10, 20, 30을 만들 수 없는 경우
- 망통: 끗수가 0인 경우 (예: 10+10=0끗[망통])
- 장땡: 가장 높은 땡으로 10+10인 경우

### 1.2 베팅 관련 용어
- 단폴베팅: 최초 베터가 두 개의 스팟만 선택 가능한 베팅 방식
- 조합베팅: 동일 스팟에 재베팅이 가능한 베팅 방식
- 최초 베터: 게임에서 가장 먼저 베팅한 플레이어
- 베팅 마감: 더 이상 베팅을 할 수 없는 상태
- 자동 베팅: 게임 시작과 동시에 자동으로 이루어지는 베팅

### 1.3 결과 관련 용어
- 페어(동일 끗수): 뱅커와 플레이어의 끗수가 같은 경우
- 홀/짝: 선(뱅커)의 결과값이 홀수인지 짝수인지를 판단
- 갑오: 9끗을 의미하는 특별한 호칭
- 재정산: 결과 수정 후 승패와 배당금을 다시 계산하는 것

### 1.4 시스템 용어
- 오버레이: 베팅 불가능한 상태를 표시하기 위해 스팟 위에 덮는 반투명한 레이어
- 카운트다운: 베팅 마감 전 남은 시간을 표시하는 기능
- 비고: 게임 결과의 수정 이력을 확인할 수 있는 버튼

## 2. 게임 규칙
### 2.1 기본 구조
- 3개의 스팟(1번, 2번, 3번)이 존재
- 각 스팟 당 5장의 카드 배치
- 최초 플레이어는 2개의 스팟 베팅 선택 가능
- 플레이어가 선택하지 않은 나머지 1개 스팟이 자동으로 선(뱅커)이 됨
- 뱅커가 된 스팟은 관리자에서 빨간 테두리로 표시된다.
- 게임은 뱅커와 플레이어 간의 승패 싸움

### 2.2 결과 판정 순서와 규칙
1. 황
   - 5장의 카드 중 어떤 3장을 조합해도 10, 20, 30이 되지 않는 경우
   - 황은 무조건 지는 패 (단, 모든 사람이 황이면 선이 승리)
   - 황과 망통의 대결에서는 망통이 승리

2. 짓기
   - 5장 중 3장의 카드 합이 정확히 10, 20, 30이 되는 경우
   - 가능한 조합:
     - 10: 1-1-8, 1-2-7, 1-3-6, 1-4-5, 2-2-6, 2-3-5, 3-3-4, 4-4-2
     - 20: 1-9-10, 2-8-10, 3-7-10, 3-8-9, 4-6-10, 4-7-9, 5-5-10, 5-6-9, 5-7-8, 6-6-8, 7-7-6, 8-8-4, 9-9-2
     - 30: 10-10-10
     - 남은 2장으로 땡/끗/망통 판정

3. 땡
   - 남은 2장의 카드가 같은 숫자인 경우
   - 땡은 모든 끗보다 높음
   - 가장 높은 땡은 10-10(장땡)으로 무조건 승리하는 최강의 패

4. 끗
   - 남은 2장의 숫자가 다른 경우
   - 남은 두 카드의 숫자를 더한 끝자리 숫자
   - 9끗(갑오)이 가장 높고, 0끗(망통)이 가장 낮음
   - 동일 끗수(페어)의 경우:
     - 뱅커와의 비교에서만 발생
     - 관리자 UI에서 드롭다운으로 "승/패 처리" 또는 "동점 처리" 선택
     - 승리 시 1.95배 지급
     - 패배 시 베팅금 몰수
     - 동점 시 베팅금 반환
     - 끗수가 같은데 짓기의 배수가 높은 경우는 배수가 높은 쪽이 승리한다.

### 2.3 베팅 규칙
#### 2.3.1 단폴베팅
1. 최초 베팅 유저가 1, 2, 3 베팅 스팟 중 두개에 베팅 시 나머지 하나의 베팅 스팟은 베팅 불가
   - 베팅 차단된 스팟은 클라이언트에 투명도 40%의 오버레이로 표시
   - 차단된 스팟이 자동으로 뱅커가 됨
2. 홀, 짝 베팅은 둘 중 하나만 선택 가능
   - 한쪽 베팅 시 다른 쪽 자동 차단
   - 차단 된 스팟은 투명도 40%의 오버레이로 표시
3. 차단된 뱅커 스팟과 나머지 베팅 가능 스팟 간 승패 결정

#### 2.3.2 조합베팅
1. 동일 스팟에 재베팅 가능
2. 홀, 짝 모두 베팅 가능
   - 베팅 제한 없이 양쪽 모두 베팅 가능
3. 나머지 규칙은 단폴베팅과 동일

### 2.4 홀/짝 규칙
- 선(뱅커)의 결과에 따라서만 홀/짝이 결정됨
- 선의 결과가 끗, 땡, 망통, 황인 경우 모두 홀/짝 적용
- 망통(0)의 경우 짝에 해당된다.
- 황의 경우 5장의 카드를 모두 더한 숫자의 끝자리 숫자에 의해 홀/짝이 적용된다.

## 3. 구현 사항
### 3.1 파일 구조
- `pages/game-manage.html`: 게임 관리 페이지
- `js/game-calculator.js`: 결과 계산 로직
- `js/websocket-manager.js`: 실시간 통신 처리

### 3.2 주요 기능
#### 3.2.1 실시간 결과 미리보기
- 카드 입력 시 실시간으로 결과 계산
- 각 스팟별 결과 표시한다. 
- 홀/짝 결과 표시

#### 3.2.2 베팅 처리
- 첫 베터가 선택한 두 스팟에 따라 선(뱅커) 결정
- 선으로 지정된 스팟에는 베팅 불가
- 홀/짝 베팅은 선의 결과로 승패 결정
- 베팅 마감:
  - 게임 종료 전 설정된 베팅 마감 시간(초)에 베팅 종료
  - 예: 전체 게임 시간 60초, 베팅 마감 10초 → 게임 시작 50초 후 베팅 마감 시간 카운트
  - 마감 카운트는 비디오 프레임 중앙에 카운트다운 표시
  - 카운트다운 종료 시 베팅판 닫힘
  - 카운트다운 디자인은 동그라미 검은 색 배경에 흰색 테두리 동그라미 가운데 이텔릭체로 숫자가 카운트된다.
- 베팅 제한:
  - 최대 베팅 금액은 스팟별 총 베팅액 기준으로 적용
- 베팅 실패 시 다음 메시지 표시:
  - "최대 베팅 금액 초과"
  - "잔액이 부족합니다"
  - "최소 베팅 금액보다 작습니다"
  - "베팅이 마감되었습니다"
  - "이미 선택된 스팟입니다"
- 베팅 취소 시 "베팅이 취소되었습니다." 메시지 1.5초간 표시

#### 3.2.3 결과 표시 형식
1. 집을 지은 경우:
   - 형식: [짓기카드1, 짓기카드2, 짓기카드3][짓기카드 합계], [남은 카드 두장][끗 or 땡 or 망통]
   - 예시:
     - [5, 2, 3][10], [4, 5][9끗]  // 10짓고 9끗
     - [8, 8, 4][20], [3, 3][3땡]  // 20짓고 3땡
     - [1, 4, 5][10], [10, 10][장땡]  // 10짓고 장땡
     - [2, 3, 5][10], [1, 9][0끗]  // 10짓고 망통

2. 집을 짓지 못한 경우:
   - 형식: [다섯장의 카드를 모두 나열][황]
   - 예시:
     - [1, 1, 2, 2, 5][황]  // 어떤 조합으로도 10,20,30을 만들 수 없는 경우
     - [1, 2, 3, 4, 6][황]  // 모든 카드가 다르고 10,20,30을 만들 수 없는 경우

### 3.3 자동 베팅 시스템
- 게임 시작과 동시에 2개의 스팟에 자동 베팅 처리
- 자동 베팅보다 빠른 플레이어 베팅 발생 시:
  - 관리자에게 alert로 게임 진행 여부 확인
  - 계속 진행 시 플레이어가 선택한 스팟 제외한 스팟이 선이 됨
  - 중단 시 게임 정지 및 베팅금 반환
- 자동 베팅 오류 처리:
  1. 베팅 금액 초과 시:
     - "자동 베팅금이 설정한 베팅금을 벗어났습니다.(베팅된 금액) 확인해주세요." 메시지 표시
     - 관리자 확인 후 수동으로 베팅 진행 가능
  2. 베팅 실패 시:
     - 최대 2회까지 자동 재시도
     - 각 실패 시마다 관리자에게 실패 알림
     - 2회 실패 시 "자동 베팅이 실패하였습니다. 수동 베팅으로 해주세요." 메시지 표시
  3. 시스템 오류 시:
     - 게임 자동 정지
     - 모든 베팅 취소
     - "시스템 오류로 게임이 정지되었습니다." 메시지 표시
- 랜덤 베팅 선택:
  - 1, 2, 3번 스팟 중 무작위로 2개 선택
  - 선택된 스팟에 설정된 자동 베팅 금액으로 베팅
- 자동 베팅 금액:
  - 별도의 최소/최대 베팅 제한 없음
  - 설정된 자동 베팅 금액으로 동시에 베팅 처리
- 자동 베팅 취소:
  - 관리자의 게임 정지로만 가능
  - 취소 시 모든 베팅금 반환
  - "자동 베팅이 취소되었습니다." 메시지 표시

### 3.4 수수료 처리
- 선에게 지거나 다른 회원에게 패한 회원의 베팅금은 몰수되며 수수료 미부과
- 선을 제외한 승리자는 베팅금을 제외한 승리금에서 수수료 부과
- 수수료율은 관리자 설정 가능

### 3.5 연결 관리
- WebSocket 연결 끊김 시 자동 재연결 시도
- 게임 중 연결 끊김 시:
  - 게임 자동 중지
  - 베팅금 반환
  - "접속이 원활하지 않아 게임이 중지 되었습니다." 메시지 표시
- 브라우저 닫힘 처리:
  - 관리자가 브라우저를 닫아도 게임은 계속 진행
  - 최초 베팅자의 베팅은 브라우저 닫힘에도 유지
  - 일반 플레이어의 브라우저 닫힘 시 자동 베팅 취소

### 3.6 게임 히스토리
- 각 게임의 결과 기록
- 결과 수정 기능:
  - 수정 이력 저장 (수정자, 시간, 내용)
  - 수정 횟수 제한 없음
  - 수정 내역은 비고 버튼 클릭 시 팝업으로 표시
    - 수정 횟수 표시
    - 각 수정 건의 수정자, 시간, 변경 내용 표시
  - 수정된 결과로 재정산 처리
- 결과 입력 오류 처리:
  - 카드 숫자 범위(1-10) 초과 시 "존재할 수 있는 카드숫자가 아님니다." 메시지 표시

### 3.7 게임 설정
#### 3.7.1 기본 설정값
- 게임 설정 기본값:
  - 베팅모드: 단폴 베팅
  - 전체 게임 시간: 60초
  - 베팅 마감 시간: 10초
  - 자동 베팅 사용: 활성화
  - 자동 베팅 금액: 1,000원

- 베팅 스팟 설정 기본값:
  - 최소 베팅: 1,000원
  - 최대 베팅: 10,000,000원
  - 배당율: 1.95
  - 상태: 활성화

- 설정값 저장:
  - 설정 저장 시 DB에 저장
  - 브라우저 종료나 서버 재연결 시에도 설정 유지

- 설정 처리:
  - 설정 저장 시 "설정이 저장되었습니다." 메시지 1.5초간 표시
  - 게임 진행 중에는 모든 설정 필드 비활성화

#### 3.7.2 설정 제한
- 배당률: 제한 없음 (0일 경우 배당 없음)
- 수수료율: 제한 없음 (0일 경우 수수료 없음)
- 타이머:
  - 최소값: 전체 게임 시간 5초, 베팅 마감 시간 3초
  - 최대값: 제한 없음

#### 3.8.1 기본 설정
1. 설정 가능 항목
   - 최소 베팅액 (1,000원 이상)
   - 최대 베팅액 (최소 베팅액보다 큼)
   - 배당률 (1.0 이상)
   - 스팟 상태 (활성/비활성)

2. 실시간 동기화
   - 모든 설정 변경은 실시간으로 클라이언트에 반영
   - 배당률 변경 시 즉시 클라이언트 UI 업데이트
   - 변경 사항은 현재 게임에는 영향을 주지 않음
   - 다음 게임부터 새로운 설정 적용

3. 제한 사항
   - 게임 진행 중에는 설정 변경 불가
   - 비활성 상태의 스팟은 베팅 불가
   - 잘못된 설정값 입력 시 경고 메시지 표시

### 3.8 UI/UX
#### 3.8.1 베팅 상태 표시
- 베팅 가능 상태: 기본 상태로 표시
- 베팅 불가능 상태: 
  - 베팅판 전체에 검정색 40% 투명도 오버레이 적용
  - 베팅 입력 불가 처리

#### 3.8.2 시스템 메시지 표시
- 표시 위치: 비디오 프레임 중앙
- 표시 시간: 1.5초
- 표시 순서:
  - 동시 발생 메시지는 발생 시간순으로 순차 처리
  - 각 메시지는 이전 메시지 표시 완료 후 표시
- 메시지 종류:
  1. 베팅 관련
     - 성공: "베팅에 성공하였습니다."
     - 실패: "최대 베팅 금액 초과", "잔액이 부족합니다" 등
     - 취소: "베팅이 취소되었습니다."
  2. 게임 진행
     - 시작: "게임이 시작되었습니다."
     - 정지: "게임이 정지되었습니다."
     - 마감: "게임이 마감되었습니다."
  3. 결과 처리
     - 저장: "결과가 저장되었습니다."
     - 수정: "결과가 수정되었습니다."
     - 오류: "존재할 수 있는 카드숫자가 아님니다."
  4. 설정
     - 저장: "설정이 저장되었습니다."
- 디자인: 검은색 배경(투명도 50%)

### 3.9 게임 진행 순서
#### 3.9.1 게임 시작 및 베팅
1. 게임 시작 조건
   - 관리자의 게임 시작 버튼 클릭으로만 시작 가능
   - 이전 게임의 결과 처리가 완료된 상태여야 함
   - 시스템 오류가 없는 상태여야 함

2. 게임 시작 시 처리 순서
   a. 자동 베팅 처리 (활성화된 경우)
      - 설정된 금액으로 랜덤 2개 스팟에 베팅
      - 자동 베팅 실패 시 관리자에게 알림
   b. 타이머 시작
      - 설정된 전체 게임 시간으로 카운트다운
      - 실시간으로 모든 클라이언트에 동기화
   c. 베팅판 오픈
      - 모든 클라이언트에 베팅 가능 상태 전달
      - 오버레이 제거로 베팅 가능 표시

3. 베팅 진행
   - 설정된 게임 시간 동안 플레이어 베팅 가능
   - 최초 베터의 선택에 따라 뱅커 스팟 결정
   - 실시간 베팅 현황 업데이트

#### 3.9.2 베팅 마감 처리
1. 마감 카운트다운 시작 조건
   - 설정된 베팅 마감 시간에 도달
   - 실제 베팅은 계속 가능한 상태 유지

2. 마감 카운트다운 표시
   - 위치: 비디오 프레임 중앙
   - 디자인: 검은색 배경, 흰색 테두리 원형, 이텔릭체 숫자
   - 시간: 설정된 마감 시간부터 카운트다운
   - 목적: 플레이어에게 마감 임박 알림용
   - "베팅이 마감되었습니다" 메시지 표시하지 않음

3. 실제 베팅 마감
   - 전체 게임 시간 종료 시점에 베팅 마감
   - 베팅판에 오버레이 적용(투명도 40%)
   - 추가 베팅 시도 차단

#### 3.9.2 결과 처리
1. 게임 마감 후 관리자가 결과 입력
   - 결과 입력에 시간 제한 없음
   - 다음 게임 시작 전까지 입력 가능
2. 결과 입력 완료 시:
   - 히스토리에 게임 결과 저장
   - "결과가 저장되었습니다." 메시지 1.5초간 표시
   - 승/패 결정
   - 승리한 플레이어에게 배당률에 따른 금액 지급 (수수료 제외)
3. 다음 게임
   - 관리자의 게임 시작 버튼 클릭으로 새 게임 시작
4. 결과 수정
   - 잘못된 결과 입력 시 히스토리에서 수정 가능
   - "결과가 수정되었습니다." 메시지 1.5초간 표시
   - 수정된 결과에 따라 금액 재정산

#### 3.9.3 게임 중단 및 취소
1. 최초 베팅자의 베팅 취소
   - 관리자의 게임 정지 클릭으로만 가능
   - 전체 베팅 취소 시에만 가능
2. 베팅 마감 전 게임 정지
   - 모든 베팅 취소됨
   - 게임 자동 시작되지 않음
   - 관리자의 게임 시작 클릭으로만 재개 가능
- 게임 상태 메시지:
  - 관리자 게임 정지 시 "게임이 정지되었습니다." 메시지 표시
  - 게임 자동 마감 시 "게임이 마감되었습니다." 메시지 표시
  - 모든 메시지는 비디오 프레임 중앙에 1.5초간 표시

#### 3.9.4 베팅 취소 및 재베팅
- 관리자에 의한 게임 정지로 취소된 경우:
  - 모든 베팅 취소
  - 다음 게임 시작 후 재베팅 가능
- 플레이어에 의한 베팅 취소:
  - 베팅 마감 전까지 취소 가능
  - 취소 후 마감 전까지 재베팅 가능
- 최초 베팅자 베팅:
  - 두 스팟에 서로 다른 금액으로 베팅 가능
  - 자동 베팅의 경우 설정된 동일 금액으로 베팅

## 4. 개발 참고사항
### 4.1 결과 계산 로직
- `GameCalculator` 클래스에서 모든 결과 계산 처리
- 각 결과 타입별 전용 계산 메서드 구현
- 실시간 미리보기를 위한 최적화된 계산 로직

### 4.2 실시간 처리
- WebSocket을 통한 실시간 데이터 동기화
- 카드 입력 시 즉시 결과 업데이트
- 베팅금, 베팅된 수, 베팅취소, 베팅스팟 등 베팅 상태 실시간 반영
- 게임설정에서 설정된 데이터 실시간 반영
- 게임 중 게임설정, 베팅 스팟 설정의 인풋필드는 차단된다.

### 4.3 에러 처리
- 잘못된 카드 입력 검증
- 베팅 규칙 위반 검사
- 실시간 통신 오류 복구
- 카드 숫자 입력 오류:
  - 10 초과 숫자 입력 시 "해당하는 카드의 숫자가 없습니다." 메시지 표시

### 4.10 관리자-클라이언트 연결 시스템
#### 4.10.1 연결 구조
- WebSocket 서버를 통한 양방향 실시간 통신
- 관리자와 클라이언트는 각각 고유 식별자(ID) 부여
- 연결 상태 실시간 모니터링

#### 4.10.2 데이터 동기화
1. 게임 상태 동기화
   - 게임 시작/종료 상태
   - 베팅 가능/불가능 상태
   - 현재 베팅 현황
   - 타이머 상태

2. 베팅 정보 동기화
   - 실시간 베팅 금액 업데이트
   - 베팅 스팟별 총액
   - 베팅 제한 상태
   - 베팅 차단 정보

3. 결과 동기화
   - 게임 결과 실시간 전송
   - 승패 결과 즉시 반영
   - 배당금 지급 상태

#### 4.10.3 오류 처리
1. 연결 끊김 처리
   - 관리자 연결 끊김:
     - 현재 게임 상태 유지
     - 재연결 시 이전 상태 복구
     - 게임 진행 중이었다면 계속 진행
   - 클라이언트 연결 끊김:
     - 현재 베팅 상태 유지
     - 재연결 시 최신 게임 상태 동기화
     - 베팅 마감 전이라면 추가 베팅 가능

2. 데이터 불일치 처리
   - 정기적인 상태 검증
   - 불일치 발견 시 서버 데이터 기준으로 동기화
   - 동기화 실패 시 관리자에게 알림

#### 4.10.4 보안
1. 연결 인증
   - 관리자/클라이언트 권한 검증
   - 세션 기반 인증
   - 비정상 접근 차단

2. 데이터 검증
   - 모든 베팅 데이터 서버측 검증
   - 비정상 베팅 시도 감지 및 차단
   - 동시성 제어를 통한 데이터 정합성 보장

#### 4.10.5 모니터링
1. 실시간 모니터링
   - 현재 접속자 수
   - 게임별 베팅 현황
   - 시스템 부하 상태
   - 오류 발생 현황

2. 로그 기록
   - 모든 게임 진행 상황 기록
   - 베팅 이력 저장
   - 오류 및 시스템 메시지 기록
   - 관리자 작업 이력 보관

#### 4.10.6 확장성
- 다중 게임 동시 운영 지원
- 부하 분산 처리
- 서버 확장 고려한 설계
- 다양한 클라이언트 플랫폼 지원

### 4.11 데이터베이스 구조
#### 4.11.1 게임 테이블
- game_history
  - game_id (PK): 게임 고유 번호
  - start_time: 게임 시작 시간
  - end_time: 게임 종료 시간
  - game_status: 게임 상태 (WAITING/RUNNING/FINISHED/CANCELLED)
  - betting_mode: 베팅 모드 (SINGLE/COMBINATION)
  - banker_spot: 뱅커 스팟 번호
  - result_data: JSON 형식의 결과 데이터
    ```json
    {
      "spot1": {
        "cards": [1,2,3,4,5],
        "result": "황",
        "odd_even": "홀"
      },
      "spot2": {
        "cards": [5,5,5,3,3],
        "result": "15짓고 3땡"
      },
      "spot3": {
        "cards": [1,2,7,8,9],
        "result": "10짓고 7끗"
      }
    }
    ```
  - created_at: 생성 시간
  - updated_at: 수정 시간

#### 4.11.2 베팅 테이블
- betting_history
  - betting_id (PK): 베팅 고유 번호
  - game_id (FK): 게임 번호
  - user_id: 유저 ID
  - spot_number: 베팅 스팟 번호
  - amount: 베팅 금액
  - result_status: 결과 상태 (WIN/LOSE/DRAW/CANCELLED)
  - payout_amount: 지급 금액
  - commission_amount: 수수료
  - created_at: 베팅 시간
  - cancelled_at: 취소 시간

#### 4.11.3 설정 테이블
- game_settings
  - setting_id (PK): 설정 고유 번호
  - setting_key: 설정 키
  - setting_value: 설정 값
  - setting_type: 설정 타입 (GAME/BETTING/SYSTEM)
  - updated_by: 수정자
  - updated_at: 수정 시간

### 4.12 권한 관리
#### 4.12.1 관리자 레벨
1. 슈퍼 관리자 (Level 1)
   - 모든 설정 변경 권한
   - 관리자 계정 관리
   - 게임 이력 관리
   - 시스템 설정 변경

2. 일반 관리자 (Level 2)
   - 게임 운영 권한
   - 결과 입력/수정
   - 실시간 모니터링
   - 베팅 설정 변경

3. 모니터링 관리자 (Level 3)
   - 게임 상태 조회
   - 베팅 현황 조회
   - 통계 데이터 조회

#### 4.12.2 권한 제어
- API 접근 제어
  - JWT 기반 인증
  - 권한 레벨별 API 접근 제한
  - 토큰 만료 시간: 12시간

- 작업 로그 기록
  - 모든 관리자 작업 기록
  - 설정 변경 이력 저장
  - 결과 수정 이력 보관

### 4.13 성능 및 부하 관리
#### 4.13.1 동시 접속 처리
- 접속자 관리
  - 최대 동시 접속자: 10,000명
  - 접속자별 고유 세션 ID 부여
  - 비활성 세션 자동 정리 (30분)

- 부하 분산
  - 게임별 독립 프로세스 운영
  - 메모리 캐시를 통한 성능 최적화
  - 주기적인 데이터 동기화 (1초 간격)

#### 4.13.2 자동화된 오류 복구
- 연결 재시도
  - 최대 재시도 횟수: 5회
  - 재시도 간격: 1초, 2초, 4초, 8초, 16초
  - 모든 재시도 실패 시 수동 조치 필요

- 데이터 정합성 검증
  - 주기적 상태 검증 (5초 간격)
  - 불일치 발견 시 자동 동기화
  - 동기화 실패 시 관리자 알림

#### 4.13.3 배당금 계산 상세
1. 기본 승리 배당
   - 배당률: 1.95
   - 계산식: 베팅금액 * 배당률

2. 수수료 계산
   - 수수료율: 관리자 설정값
   - 계산식: (승리금액 - 베팅금액) * 수수료율

3. 최종 지급액
   - 계산식: 베팅금액 + (승리금액 - 수수료)
   - 소수점 처리: 소수점 이하 절사

### 4.14 보안
#### 4.14.1 데이터 보안
- 통신 암호화
  - WebSocket: WS/WSS 프로토콜 사용(설정환경에 따라 다름)
  - API: HTTPS/HTTP 적용(설정환경에 따라 다름)
  - 데이터 암호화: AES-256

- 데이터 검증
  - 모든 입력값 서버측 검증
  - SQL Injection 방지
  - XSS 공격 방지

#### 4.14.2 세션 관리
- 세션 정책
  - 세션 만료 시간: 12시간
  - 동시 접속 제한: 1개 기기
  - 자동 로그아웃: 30분 미활동 시

- 비정상 접근 차단
  - IP 기반 접근 제한
  - 비정상 패턴 감지
  - 자동화된 공격 차단

#### 4.14.3 보안 확장
- 다중 게임 동시 운영 지원
- 부하 분산 처리
- 서버 확장 고려한 설계
- 다양한 클라이언트 플랫폼 지원